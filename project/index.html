<!doctype html>
<html lang="en">
<head>
  <link rel="stylesheet" href="/assets/tabs.css?v=1">
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover"/>
  <title>Project — Seth Easter Design</title>

  <link rel="icon" href="/assets/icons/favicon-32.png" sizes="32x32">
  <link rel="icon" href="/assets/icons/favicon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png" sizes="180x180">

  <link rel="stylesheet" href="/assets/styles.css?v=v2"/>
  <link rel="stylesheet" href="/assets/fix.v3.css?v=3"/>
</head>
<body id="project-page">
  <header class="header">
    <div class="container nav">
      <a href="/" class="brand"><img class="brand-logo" src="/assets/sed-logo-tight.svg" alt="SED"></a>
      <ul class="nav-links" id="topNav">
        <li><a href="/work/">Work</a></li>
        <li><a href="/press/">Press &amp; Awards</a></li>
        <li><a href="/cv.html">CV</a></li>
      </ul>
    </div>
  </header>

  <main class="container proj-wrap">
    <section class="section" id="project-shell">
      <h2 id="projTitle">Project</h2>
      <div id="projMeta" class="subtle"></div>

      <div id="projViewer" class="viewer"></div>
      <div id="projStrip" class="strip" aria-label="Thumbnails"></div>

      <div id="projDesc" class="meta" style="margin-top:8px"></div>
	  <div id="projPdfs" class="pdf-container"></div>

      <div id="projNotice" class="meta" style="margin-top:12px;color:#9aa0a6;"></div>
    </section>
  </main>

  <script>
  (function(){
    'use strict';
    const qp=new URLSearchParams(location.search);
    const slug=(qp.get('slug')||'').trim();
    const t=document.getElementById('projTitle'),
          m=document.getElementById('projMeta'),
          v=document.getElementById('projViewer'),
          s=document.getElementById('projStrip'),
          d=document.getElementById('projDesc'),
          n=document.getElementById('projNotice');

    const fix=p=>!p?p:(/^https?:\/\//i.test(p)||p.startsWith('/'))?p:'/'+p.replace(/^\/+/,'');
    async function getJSON(u){ const r=await fetch(u+(u.includes('?')?'&':'?')+'v='+Date.now(),{cache:'no-store'}); if(!r.ok) throw new Error('HTTP '+r.status); return r.json(); }

    function openLB(item,idx){
      const mm=item.media[idx]; if(!mm) return;
      const wrap=document.createElement('div'); wrap.id='lbV3'; wrap.className='open';
      wrap.innerHTML='<div class="main"><button class="prev" aria-label="Previous">‹</button><div id="lbV3c"></div><button class="next" aria-label="Next">›</button><button class="x" aria-label="Close">✕</button></div><div class="strip" id="lbV3s"></div>';
      document.body.appendChild(wrap);
      const lbc=document.getElementById('lbV3c'), lbs=document.getElementById('lbV3s');
      function render(i){
        const m=item.media[i]; lbc.innerHTML='';
        lbc.appendChild(m.type==='video' ? Object.assign(document.createElement('video'),{src:m.src,controls:true,playsinline:true}) : Object.assign(document.createElement('img'),{src:m.src,alt:item.title||''}));
        lbs.innerHTML='';
        item.media.forEach((mm,j)=>{ const ts=mm.type==='image'?mm.src:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="80"><rect width="120" height="80" fill="%23000"/><polygon points="45,25 45,55 75,40" fill="%23fff"/></svg>'; const im=Object.assign(document.createElement('img'),{src:ts}); if(j===i) im.classList.add('active'); im.onclick=()=>render(j); lbs.appendChild(im); });
        idx=i;
      }
      render(idx);
      wrap.querySelector('.x').onclick=()=>wrap.remove();
      wrap.querySelector('.prev').onclick=()=>render((idx-1+item.media.length)%item.media.length);
      wrap.querySelector('.next').onclick=()=>render((idx+1)%item.media.length);
      wrap.onclick=e=>{ if(e.target===wrap) wrap.remove(); };
    }

    function openInViewer(item, idx){
      const mm=item.media[idx]; if(!mm) return;
      v.innerHTML='';
      const el = (mm.type==='video')
        ? Object.assign(document.createElement('video'),{src:mm.src,controls:true,playsinline:true})
        : Object.assign(document.createElement('img'),  {src:mm.src,alt:item.title||''});
      v.appendChild(el);
      Array.from(s.children).forEach((im,i)=> im.classList.toggle('active', i===idx));
      v.onclick = ()=> openLB(item, idx);
    }

    (async function(){
      let list=[];
      try { list = await getJSON('/assets/work.json'); } catch(e){
        n.textContent = 'Could not load /assets/work.json';
        return;
      }
      if(!Array.isArray(list)){ n.textContent='Invalid work.json'; return; }

      const items = list.map((raw,i)=>{
  const gallery = Array.isArray(raw.gallery) ? raw.gallery.map(fix) : [];
  const media   = Array.isArray(raw.media) && raw.media.length
    ? raw.media.map(m => m && m.type ? ({ ...m, src: fix(m.src) }) : ({ type:'image', src: fix(m) }))
    : gallery.map(src => ({ type:'image', src }));

  const draftings = Array.isArray(raw.draftings)
    ? raw.draftings.map(fix)
    : (raw.draftings ? [fix(raw.draftings)] : []);

  const pdf = typeof raw.pdf === 'string' && raw.pdf.trim() ? fix(raw.pdf) : null;

  return {
    id: raw.id || raw.slug || `item-${i+1}`,
    slug: (raw.slug||raw.id||'').trim(),
    title: raw.title || '',
    client: raw.client || '',
    role: raw.role || '',
    year: raw.year || '',
    description: raw.description || '',
    media,
    pdf,
    draftings
  };
});

      let item = items.find(x=> x.slug===slug || x.id===slug);
      if(!item){
        // Stay on page, tell the user, and offer first item as a default view
        n.textContent = slug ? `Project “${slug}” not found. Showing first project.` : 'No project specified.';
        item = items[0];
        if(!item) return;
      }

      t.textContent = item.title || 'Project';
      m.textContent = [item.role, item.client, item.year].filter(Boolean).join(' • ');
      d.textContent = item.description || '';
// Render PDF links
const pdfEl = document.getElementById('projPdfs');
pdfEl.innerHTML = '';

const pdfList = [];
if (item.pdf) pdfList.push(item.pdf);
if (Array.isArray(item.draftings) && item.draftings.length) pdfList.push(...item.draftings);

if (pdfList.length) {
  pdfList.forEach((href, i) => {
    const a = document.createElement('a');
    a.href = href;
    a.target = '_blank';
    a.rel = 'noopener';
    a.textContent = pdfList.length > 1 ? `View PDF ${i+1}` : 'View PDF';
    a.className = 'pdf-link';
    pdfEl.appendChild(a);
  });
}

      s.innerHTML='';
      item.media.forEach((mm,i)=>{
        const ts = mm.type==='image'? mm.src :
          'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="80"><rect width="120" height="80" fill="%23000"/><polygon points="45,25 45,55 75,40" fill="%23fff"/></svg>';
        const im = Object.assign(document.createElement('img'),{src:ts,alt:'thumb'});
        if(i===0) im.classList.add('active');
        im.addEventListener('click',()=> openInViewer(item,i));
        s.appendChild(im);
      });
      openInViewer(item,0);
    })();
  })();
  </script>
	<script src="/js/project.tabs.js?v=1" defer></script>
</body>
</html>