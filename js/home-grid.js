(function(){"use strict";var PLACEHOLDER="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 9'><rect width='16' height='9' fill='%23f0f0f0'/> </svg>";function gridEl(){return document.getElementById('homeGrid')||document.getElementById('workGrid')||document.querySelector('[data-grid="work"]')||document.querySelector('.work-grid');}function sentinelEl(g){var s=document.getElementById('gridSentinel');if(!s){s=document.createElement('div');s.id='gridSentinel';s.style.height='1px';(g.parentNode||document.body).appendChild(s);}return s;}function tryFetch(url){return fetch(url,{cache:'no-store'}).then(function(r){if(!r.ok)throw 0;return r.json();});}function loadList(cb){var bases=['/assets/work.json','./assets/work.json','../assets/work.json'];(function next(i){if(i>=bases.length)return cb([]);tryFetch(bases[i]+'?v='+Date.now()).then(function(d){cb(Array.isArray(d)?d:[]);}).catch(function(){next(i+1);});})(0);}function card(it){var title=it.title||'Untitled Project';var meta=[it.client,it.year,it.role].filter(Boolean).join(' Â· ');var cover=it.cover||(it.gallery&&it.gallery[0])||PLACEHOLDER;var href=it.slug?('/project.html?slug='+encodeURIComponent(it.slug)):'#';var html='<article class="card"><a class="cover" href="'+href+'"><span class="ratio-169"><img loading="lazy" src="'+cover+'" alt=""></span></a><div class="footer"><a href="'+href+'">'+title+'</a>'+(meta?'<div class="meta">'+meta+'</div>':'')+'</div></article>';return html;}function attachImageFallback(root){root.addEventListener('error',function(e){var img=e.target&&e.target.tagName==='IMG'?e.target:null;if(!img)return;img.src=PLACEHOLDER;img.setAttribute('data-ph','1');},true);}function start(list){var g=gridEl();if(!g)return;attachImageFallback(g);var s=sentinelEl(g);var i=0,PAGE=12,loading=false,done=false;function renderMore(){if(done||loading)return;loading=true;var end=Math.min(i+PAGE,list.length),html='';for(var k=i;k<end;k++)html+=card(list[k]);i=end;if(html){var tmp=document.createElement('div');tmp.innerHTML=html;while(tmp.firstChild)g.appendChild(tmp.firstChild);}if(i>=list.length)done=true;loading=false;}if('IntersectionObserver'in window){var io=new IntersectionObserver(function(ents){for(var j=0;j<ents.length;j++)if(ents[j].isIntersecting)renderMore();},{rootMargin:'0px 0px 200px 0px'});io.observe(s);}else{function onScroll(){var rect=s.getBoundingClientRect();var vh=window.innerHeight||document.documentElement.clientHeight;if(rect.top<vh+200)renderMore();}window.addEventListener('scroll',onScroll);}renderMore();}function normalize(list){for(var i=0;i<list.length;i++){var it=list[i];if(it.cover&&it.cover.charAt(0)!=='/')it.cover='/'+it.cover.replace(/^\/+/,'' );if(it.gallery&&it.gallery.length)for(var j=0;j<it.gallery.length;j++){var s=it.gallery[j];it.gallery[j]=(s.charAt(0)==='/'?s:'/'+s.replace(/^\/+/,''));}}return list;}function init(){loadList(function(list){start(normalize(Array.isArray(list)?list:[]));});}if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',init);else init();})();
